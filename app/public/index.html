<!doctype html>
<html>
  <head>
    <title>Vizify</title>
    <!-- <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css'> -->
    <link type='text/css' href='styles.css' rel='stylesheet' />
    <link type='text/css' href='sp-bootstrap.min.css' rel='stylesheet' media='screen'>
    <style type='text/css'>
      #login, #loggedin {
        display: none;
      }
      #vizify {
        width: 80px;
        text-align: center;
      }
      #vizifyCanvas {
        padding-top: 80px;
      }
    </style>
  </head>
  <body>
    <div class='container'>
      <div id='login'>
        <!-- TODO: put in cool log in page -->
        <h1> Log in to get started. </h1>
        <a href='/login' class='btn btn-primary'> Log in with Spotify </a>
      </div>
    </div>
    <div id='loggedin'>
      <div class='navbar navbar-default navbar-fixed-top' role='navigation'>
        <div class='container'>
          <div class='navbar-header'>
            <a class='navbar-brand' href='#'><span>&nbsp;Vizify&nbsp;</span></a>
          </div>
        </div>
      </div>
<!--       <div id='hero' class='hero-unit'>
        <div class='container'>
          <h1> Vizify </h1>
          <p class='lead'> Visualize your Spotify collection. </p>
          <button class='btn btn-info btn-large' id='vizify' type='button'>
             Go
          </button>
          <div id='info'></div>
        </div>
      </div> -->
    </div>

    <canvas id='vizifyCanvas' width='2400' height='2400'></canvas>

    <script src='http://code.jquery.com/jquery-1.10.1.min.js'></script>
    <script src='/js/spotify.js'></script>
    <script src='/js/vizify_data.js'></script>
    <script src='/js/vizify.js'></script>
    <script>
      (function() {
        // TODO: make a dynamic animation (i.e. update the model each time new
        // data is entered)

        /**
         * Obtains parameters from the hash of the URL
         * @return Object
         */
        function getHashParams() {
          var params,
              hashParams = {},
              regex = /([^&;=]+)=?([^&;]*)/g,
              urlAnchor = window.location.hash.substring(1);

          while (params = regex.exec(urlAnchor)) {
             hashParams[params[1]] = decodeURIComponent(params[2]);
          }

          return hashParams;
        }

        var params = getHashParams();

        var access_token = params.access_token,
            error = params.error;

        if (error) {
          alert('There was an error during the authentication');
        } else {
          if (access_token) {
            document.getElementById('login').style.display = 'none';
            document.getElementById('loggedin').style.display = 'inline';
          } else {
            document.getElementById('login').style.display = 'inline';
            document.getElementById('loggedin').style.display = 'none';
          }
        }

        // TODO: add static variables http://stackoverflow.com/a/1535687/854645
        var _vizify = new vizify();
        _vizify.getVisualization();
        // TODO: consider just drawing so it doesn't have to re-fetch data
        window.addEventListener('resize', function() {
          _vizify.getVisualization();
        }, true);
        // document.getElementById('vizify').addEventListener('click', function() {
        // });

      })();
    </script>
  </body>
</html>
